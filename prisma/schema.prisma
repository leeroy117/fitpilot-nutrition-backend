generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  schemas  = ["nutrition", "public"]
}

model allergens {
  id               Int                @id @default(autoincrement())
  name             String             @db.VarChar(50)
  client_allergens client_allergens[]
  food_allergens   food_allergens[]

  @@schema("nutrition")
}

model biometric_logs {
  id               Int       @id @default(autoincrement())
  user_id          Int?
  logged_at        DateTime? @default(dbgenerated("CURRENT_DATE")) @db.Date
  weight_kg        Decimal?  @db.Decimal(5, 2)
  body_fat_percent Decimal?  @db.Decimal(4, 2)
  users            users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("nutrition")
}

model client_allergens {
  user_id     Int
  allergen_id Int
  allergens   allergens @relation(fields: [allergen_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, allergen_id])
  @@schema("nutrition")
}

model daily_targets {
  id                 Int       @id @default(autoincrement())
  user_id            Int?
  start_date         DateTime? @default(dbgenerated("CURRENT_DATE")) @db.Date
  end_date           DateTime? @db.Date
  target_energy_kcal Int?
  target_protein_g   Int?
  target_carbs_g     Int?
  target_fat_g       Int?
  users              users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("nutrition")
}

model data_sources {
  id    Int     @id @default(autoincrement())
  name  String  @db.VarChar(100)
  foods foods[]

  @@schema("nutrition")
}

model exchange_groups {
  id               Int               @id @default(autoincrement())
  system_id        Int?
  name             String            @db.VarChar(100)
  avg_energy_kcal  Int?
  color_code       String?           @db.VarChar(7)
  exchange_systems exchange_systems? @relation(fields: [system_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  foods            foods[]

  @@schema("nutrition")
}

model exchange_systems {
  id              Int               @id @default(autoincrement())
  name            String            @db.VarChar(100)
  exchange_groups exchange_groups[]

  @@schema("nutrition")
}

model food_allergens {
  food_id     Int
  allergen_id Int
  allergens   allergens @relation(fields: [allergen_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  foods       foods     @relation(fields: [food_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([food_id, allergen_id])
  @@schema("nutrition")
}

model food_categories {
  id    Int     @id @default(autoincrement())
  name  String  @db.VarChar(100)
  icon  String? @db.VarChar(50)
  foods foods[]

  @@schema("nutrition")
}

model food_logs {
  id              Int            @id @default(autoincrement())
  user_id         Int?
  food_id         Int?
  logged_at       DateTime?      @default(now()) @db.Timestamp(6)
  meal_type       String?        @db.VarChar(20)
  quantity        Decimal?       @db.Decimal(10, 2)
  serving_unit_id Int?
  foods           foods?         @relation(fields: [food_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  serving_units   serving_units? @relation(fields: [serving_unit_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users           users?         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("nutrition")
}

model food_nutrients {
  id          Int        @id @default(autoincrement())
  food_id     Int?
  nutrient_id Int?
  amount      Decimal    @db.Decimal(10, 4)
  foods       foods?     @relation(fields: [food_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  nutrients   nutrients? @relation(fields: [nutrient_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("nutrition")
}

model foods {
  id                                                              Int                  @id @default(autoincrement())
  name                                                            String               @db.VarChar(255)
  brand                                                           String?              @db.VarChar(100)
  barcode                                                         String?              @db.VarChar(50)
  category_id                                                     Int?
  data_source_id                                                  Int?
  exchange_group_id                                               Int?
  is_recipe                                                       Boolean?             @default(false)
  glycemic_index                                                  Int?
  glycemic_load_per_100g                                          Decimal?             @db.Decimal(10, 2)
  base_serving_size                                               Decimal?             @default(100) @db.Decimal(10, 2)
  base_unit                                                       String?              @default("g") @db.VarChar(20)
  food_allergens                                                  food_allergens[]
  food_logs                                                       food_logs[]
  food_nutrients                                                  food_nutrients[]
  food_categories                                                 food_categories?     @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  data_sources                                                    data_sources?        @relation(fields: [data_source_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  exchange_groups                                                 exchange_groups?     @relation(fields: [exchange_group_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  meal_plan_items                                                 meal_plan_items[]
  recipe_ingredients_recipe_ingredients_ingredient_food_idTofoods recipe_ingredients[] @relation("recipe_ingredients_ingredient_food_idTofoods")
  recipe_ingredients_recipe_ingredients_recipe_food_idTofoods     recipe_ingredients[] @relation("recipe_ingredients_recipe_food_idTofoods")
  recipes                                                         recipes?
  serving_units                                                   serving_units[]

  @@schema("nutrition")
}

model meal_plan_items {
  id              Int            @id @default(autoincrement())
  meal_plan_id    Int?
  food_id         Int?
  day_of_week     Int?
  meal_type       String?        @db.VarChar(20)
  quantity        Decimal?       @db.Decimal(10, 2)
  serving_unit_id Int?
  foods           foods?         @relation(fields: [food_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  meal_plans      meal_plans?    @relation(fields: [meal_plan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  serving_units   serving_units? @relation(fields: [serving_unit_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("nutrition")
}

model meal_plans {
  id                                         Int               @id @default(autoincrement())
  professional_id                            Int?
  assigned_client_id                         Int?
  name                                       String?           @db.VarChar(100)
  is_active                                  Boolean?          @default(true)
  created_at                                 DateTime?         @default(now()) @db.Timestamp(6)
  meal_plan_items                            meal_plan_items[]
  users_meal_plans_assigned_client_idTousers users?            @relation("meal_plans_assigned_client_idTousers", fields: [assigned_client_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_meal_plans_professional_idTousers    users?            @relation("meal_plans_professional_idTousers", fields: [professional_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("nutrition")
}

model nutrient_categories {
  id           Int         @id @default(autoincrement())
  name         String      @db.VarChar(50)
  is_essential Boolean?    @default(true)
  nutrients    nutrients[]

  @@schema("nutrition")
}

model nutrients {
  id                      Int                  @id @default(autoincrement())
  category_id             Int?
  name                    String               @db.VarChar(100)
  unit                    String?              @db.VarChar(20)
  daily_recommended_value Decimal?             @db.Decimal(10, 2)
  food_nutrients          food_nutrients[]
  nutrient_categories     nutrient_categories? @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("nutrition")
}

model recipe_ingredients {
  id                                                 Int            @id @default(autoincrement())
  recipe_food_id                                     Int?
  ingredient_food_id                                 Int?
  quantity                                           Decimal        @db.Decimal(10, 2)
  serving_unit_id                                    Int?
  foods_recipe_ingredients_ingredient_food_idTofoods foods?         @relation("recipe_ingredients_ingredient_food_idTofoods", fields: [ingredient_food_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  foods_recipe_ingredients_recipe_food_idTofoods     foods?         @relation("recipe_ingredients_recipe_food_idTofoods", fields: [recipe_food_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  serving_units                                      serving_units? @relation(fields: [serving_unit_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("nutrition")
}

model recipes {
  food_id            Int            @id
  created_by_user_id Int?
  instructions       String?
  prep_time_minutes  Int?
  cook_time_minutes  Int?
  total_yield        Decimal?       @db.Decimal(10, 2)
  yield_unit_id      Int?
  users              users?         @relation(fields: [created_by_user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  foods              foods          @relation(fields: [food_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  serving_units      serving_units? @relation(fields: [yield_unit_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("nutrition")
}

model serving_units {
  id                 Int                  @id @default(autoincrement())
  food_id            Int?
  unit_name          String               @db.VarChar(50)
  gram_equivalent    Decimal              @db.Decimal(10, 2)
  is_exchange_unit   Boolean?             @default(false)
  food_logs          food_logs[]
  meal_plan_items    meal_plan_items[]
  recipe_ingredients recipe_ingredients[]
  recipes            recipes[]
  foods              foods?               @relation(fields: [food_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("nutrition")
}

model client_profiles {
  user_id           Int       @id
  date_of_birth     DateTime? @db.Date
  gender            String?   @db.VarChar(10)
  height_cm         Int?
  current_weight_kg Decimal?  @db.Decimal(5, 2)
  goal              String?   @db.VarChar(50)
  users             users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

model plans {
  id               Int             @id @default(autoincrement())
  name             String          @db.VarChar(100)
  description      String?
  price_monthly    Decimal?        @db.Decimal(10, 2)
  access_nutrition Boolean?        @default(false)
  access_training  Boolean?        @default(false)
  is_active        Boolean?        @default(true)
  subscriptions    subscriptions[]

  @@schema("public")
}

model professional_clients {
  id                                                Int       @id @default(autoincrement())
  professional_id                                   Int
  client_id                                         Int
  service_type                                      String?   @db.VarChar(20)
  status                                            String?   @default("active") @db.VarChar(20)
  start_date                                        DateTime? @default(dbgenerated("CURRENT_DATE")) @db.Date
  notes                                             String?
  users_professional_clients_client_idTousers       users     @relation("professional_clients_client_idTousers", fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_professional_clients_professional_idTousers users     @relation("professional_clients_professional_idTousers", fields: [professional_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([professional_id, client_id])
  @@schema("public")
}

model professional_profiles {
  user_id            Int      @id
  title              String?  @db.VarChar(100)
  biography          String?
  specialty          String?  @db.VarChar(100)
  license_number     String?  @db.VarChar(50)
  work_address       String?
  consultation_price Decimal? @db.Decimal(10, 2)
  social_media_links String?
  users              users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

model subscriptions {
  id         Int       @id @default(autoincrement())
  user_id    Int
  plan_id    Int
  status     String?   @default("active") @db.VarChar(20)
  start_date DateTime? @default(now()) @db.Timestamp(6)
  end_date   DateTime  @db.Timestamp(6)
  auto_renew Boolean?  @default(true)
  plans      plans     @relation(fields: [plan_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}

model users {
  id                                                               Int                    @id @default(autoincrement())
  email                                                            String                 @unique @db.VarChar(255)
  password_hash                                                    String                 @db.VarChar(255)
  full_name                                                        String                 @db.VarChar(255)
  role                                                             String                 @db.VarChar(20)
  profile_photo_url                                                String?
  is_active                                                        Boolean?               @default(true)
  created_at                                                       DateTime?              @default(now()) @db.Timestamp(6)
  biometric_logs                                                   biometric_logs[]
  client_allergens                                                 client_allergens[]
  daily_targets                                                    daily_targets[]
  food_logs                                                        food_logs[]
  meal_plans_meal_plans_assigned_client_idTousers                  meal_plans[]           @relation("meal_plans_assigned_client_idTousers")
  meal_plans_meal_plans_professional_idTousers                     meal_plans[]           @relation("meal_plans_professional_idTousers")
  recipes                                                          recipes[]
  client_profiles                                                  client_profiles?
  professional_clients_professional_clients_client_idTousers       professional_clients[] @relation("professional_clients_client_idTousers")
  professional_clients_professional_clients_professional_idTousers professional_clients[] @relation("professional_clients_professional_idTousers")
  professional_profiles                                            professional_profiles?
  subscriptions                                                    subscriptions[]

  @@schema("public")
}
